/*
 ============================================================================
 Name        : Parcial-laboratorio-1.c
 Author      : Gonzalo Vidal
 Version     :
 Copyright   : Parcial laboratorio
 Description : Hello World in C, Ansi-style
 ============================================================================
 */

#include <stdio.h>
#include <stdlib.h>
#include "General.h"
#include "User.h"
#include "Product.h"
#include "Tracking.h"
#include "Relationship_TrackingUserAndProducts.h"

int main(void) {
	setbuf(stdout, NULL);
	User userList[MAX_USERS];
	Product productList[MAX_PRODUCTS];
	Tracking trackingList[MAX_TRACKINGS];
	int r;
	int startOption;
	int userOption;
	int adminOption;
	int userId = 0;

	User_initializeUsers(userList, MAX_USERS);
	Product_initializeProducts(productList, MAX_PRODUCTS);
	Tracking_initializeTrackings(trackingList, MAX_TRACKINGS);

	printMessage("BIENVENIDO A NUESTRO PROGRAMA", 2);

	do {
		utn_getNumero("1)Ingresar\n2)Registrarse\n\n0)Salir\n",
				"Ha habido un error\n", 0, 3, &startOption);
		switch (startOption) {
		case 1:
			r = User_Login(userList, MAX_USERS, &userId);
			if (r == 2) {
				printMessage("¡Bienvenido admin!", 2);
				do {
					utn_getNumero(
							"1)Comprar\n2)Vender\n3)Estado de compras\n4)Estado de ventas\n0)Salir\n",
							"Ha habido un error\n", 0, 3, &adminOption);
					switch (adminOption) {
					case 1:
						break;
					case 2:
						break;
					case 3:
						break;
					case 4:
						break;
					case 0:
						break;
					default:
						break;
					}
				} while (adminOption != 0);
				//MENU ADMIN
			} else {
				if (r == 1) {
					printMessage("¡Bienvenido usuario!", 2);
					do {
						utn_getNumero(
								"1)Comprar\n2)Vender\n3)Estado de compras\n4)Estado de ventas\n0)Salir\n",
								"Ha habido un error\n", 0, 3, &userOption);
						switch (userOption) {
						case 1:
							r = Relationship_BuyProductAndNewTracking(
									productList, MAX_PRODUCTS, trackingList,
									MAX_TRACKINGS, userList[userId]);
							if (r == 0) {
								printMessage("Compra realizada con exito!", 2);
							} else {
								if (r == -2) {
									printMessage("Compra no realizada.", 2);
								} else {
									printMessage(
											"Hubo una falla en la lista de productos.",
											2);
								}
							}
							break;
						case 2:
							if (Relationship_SellProduct(productList,
									MAX_PRODUCTS, userList[userId]) == 0) {
								printMessage(
										"¡Tu producto se ha puesto en venta!",
										2);
							} else {
								printMessage(
										"Tu producto no se pudo poner en venta :(",
										2);
							}
							break;
						case 3:
							printf("User id %d", userId);
							if (Relationship_checkTrackings(trackingList,
							MAX_TRACKINGS, productList, MAX_PRODUCTS, userList[userId])
									== 0) {
								printMessage("Gracias!", 2);
							} else {
								printMessage("Ha habido un error :/", 2);
							}
							break;
						case 4:
							break;
						case 0:
							break;
						default:
							break;
						}
					} while (userOption != 0);
					//MENU USUARIO
				} else {
					printMessage("¡Ha habido un error!", 2);
				}
			}
			break;
		case 2:
			if (User_Membership(userList, MAX_USERS) == 0) {
				printMessage("¡Usuario creado con exito!", 2);
			} else {
				printMessage("¡Ha habido un error en el registro!", 2);
			}
			break;
		case 0:
			printMessage("¡Gracias por usar nuestro programa!", 2);
			break;
		default:
			printMessage("Por favor, ingrese un numero del 0 al 2.", 2);
			break;
		}
	} while (startOption != 0);
	return EXIT_SUCCESS;
}
