/*
 ============================================================================
 Name        : Parcial-laboratorio-1.c
 Author      : Gonzalo Vidal
 Version     :
 Copyright   : Parcial laboratorio
 Description : Hello World in C, Ansi-style
 ============================================================================
 */

#include <stdio.h>
#include <stdlib.h>
#include "General.h"
#include "User.h"
#include "Product.h"
#include "Tracking.h"
#include "Relationship_TrackingUserAndProducts.h"


/*COSAS PARA HACER :
 * 1-Validaciones al User
 * 2-Validaciones a la hora de subir productos
 * 3-Validaciones de los getInt
 * 4-Refactorizar
 */




int main(void) {
	setbuf(stdout, NULL);
	User userList[MAX_USERS];
	Product productList[MAX_PRODUCTS];
	Tracking trackingList[MAX_TRACKINGS];
	int r;
	int startOption;
	int userOption;
	int adminOption;
	int userId = 0;

	User_initializeUsers(userList, MAX_USERS);
	Product_initializeProducts(productList, MAX_PRODUCTS);
	Tracking_initializeTrackings(trackingList, MAX_TRACKINGS);

	printMessage("BIENVENIDO A NUESTRO PROGRAMA", 2);

	do {
		utn_getNumero("1)Ingresar\n2)Registrarse\n\n0)Salir\n",
				"Ha habido un error\n", 0, 3, &startOption);
		switch (startOption) {
		case 1:
			r = User_Login(userList, MAX_USERS, &userId);
			if (r == 2 && userList[userId].loggedIn == 1) {
				printMessage("¡Bienvenido admin!", 2);
				do {
					if (userList[userId].loggedIn == 1) {
						utn_getNumero(
								"1)Listar estado de todos los usuarios\n2)Listar todos los productos por categoria\n3)Baja de un producto\n4)Baja de un usuario\n5)Ver tracking global\n0)Salir\n",
								"Ha habido un error\n", 0, 3, &adminOption);
						switch (adminOption) {
						case 1:
							if (User_PrintAllUsers(userList, MAX_USERS) == 0) {
								printMessage("Usuarios listados", 2);
							} else {
								printMessage("Ha habido un error", 2);
							}
							break;
						case 2:
							if (Product_PrintProducts(productList, MAX_PRODUCTS,
							ACTIVE) == 0) {
								printMessage("Productos listados", 2);
							}
							break;
						case 3:
							if (Product_RemoveProduct(productList, MAX_PRODUCTS)
									== 0) {
								printMessage("Producto dado de baja", 2);
							} else {
								printMessage(
										"El producto no ha podido darse de baja",
										2);
							}
							break;
						case 4:
							if (User_LowMembership(userList, MAX_USERS,
									userList[userId]) == 0) {
								printMessage("Usuario dado de baja", 2);
							} else {
								printMessage(
										"El usuario no ha podido darse de baja",
										2);
							}
							break;
						case 5:
							if (Tracking_PrintAndRefreshTrackings(trackingList,
							MAX_TRACKINGS) == 0) {
								printMessage("Trackings listados", 2);
							} else {
								printMessage("Ha habido un error", 2);
							}
							break;
						case 0:
							userList[userId].loggedIn = 0;
							break;
						default:
							break;
						}
					}
				} while (adminOption != 0 && userList[userId].loggedIn == 1);
				//MENU ADMIN
			} else {
				if (r == 1 && userList[userId].loggedIn) {
					printMessage("¡Bienvenido usuario!", 2);
					do {
						utn_getNumero(
								"1)Comprar\n2)Vender\n3)Estado de compras\n4)Estado de ventas\n0)Salir\n",
								"Ha habido un error\n", 0, 3, &userOption);
						switch (userOption) {
						case 1:
							r = Relationship_BuyProductAndNewTracking(
									productList, MAX_PRODUCTS, trackingList,
									MAX_TRACKINGS, userList[userId]); //Mostrar que no hay productos
							if (r == 0) {
								printMessage("Compra realizada con exito!", 2);
							} else {
								printMessage("Compra no realizada.", 2);

							}
							break;
						case 2:
							if (Relationship_SellProduct(productList,
							MAX_PRODUCTS, userList[userId]) == 0) {
								printMessage(
										"¡Tu producto se ha puesto en venta!",
										2);
							} else {
								printMessage(
										"Tu producto no se pudo poner en venta :(",
										2);
							}
							break;
						case 3:
							if (Relationship_checkBoughtTrackings(trackingList,
							MAX_TRACKINGS, productList, MAX_PRODUCTS,
									userList[userId]) == 0) {
								printMessage("Gracias!", 2);
							} else {
								printMessage("Ha habido un error :/", 2);
							}
							break;
						case 4:
							if (Relationship_checkSoldTrackings(trackingList,
							MAX_TRACKINGS, productList, MAX_PRODUCTS,
									userList[userId]) == 0) {
								printMessage("Gracias!", 2);
							} else {
								printMessage("Ha habido un error :/", 2);
							}
							break;
						case 0:
							userList[userId].loggedIn = 0;
							break;
						default:
							break;
						}
					} while (userOption != 0);
					//MENU USUARIO
				} else {
					printMessage("¡Ha habido un error!", 2);
				}
			}
			break;
		case 2:
			if (User_Membership(userList, MAX_USERS) == 0) {
				printMessage("¡Usuario creado con exito!", 2);
			} else {
				printMessage("¡Ha habido un error en el registro!", 2);
			}
			break;
		case 0:
			printMessage("¡Gracias por usar nuestro programa!", 2);
			break;
		default:
			printMessage("Por favor, ingrese un numero del 0 al 2.", 2);
			break;
		}
	} while (startOption != 0);
	return EXIT_SUCCESS;
}
